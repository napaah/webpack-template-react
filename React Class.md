# React Class

## ç”Ÿå‘½å‘¨æœŸ

react ç”Ÿå‘½å‘¨æœŸï¼š`https://projects.wojtekmaj.pl/react-lifecycle-methods-diagram/`ï¼›
å›¾è§£ react ç”Ÿå‘½å‘¨æœŸï¼š`https://juejin.cn/post/6844903510538977287`ï¼›

ç”Ÿå‘½å‘¨æœŸæ—¶æœŸï¼š

â¤µï¸ æŒ‚è½½æ—¶
ğŸ”‚ æ›´æ–°æ—¶
ğŸ”š å¸è½½æ—¶

â­ï¸ å¸¸ç”¨
ğŸ˜‘ ä¸å¸¸ç”¨
ğŸš® å·²ç§»é™¤
ğŸ’¥ æ³¨æ„

#### ç”Ÿå‘½å‘¨æœŸ

> - constructor()ï¼šåˆå§‹åŒ–stateå’Œç»‘å®šäº‹ä»¶å¤„ç†æ–¹æ³•
> - getDerivedStateFromProps()ï¼šv16.3 ä¹‹å‰åªåœ¨æŒ‚è½½é˜¶æ®µï¼Œv16.4ä¹‹åæ›´æ–°ä¹Ÿæ‰§è¡Œï¼›
> - componentWillMount()ï¼šç»„ä»¶å³å°†æŒ‚è½½ï¼Œåªè°ƒç”¨ä¸€æ¬¡ï¼ˆ**å·²åºŸå¼ƒ**ï¼‰ğŸš®
> - componentWillReceiveProps()ï¼šåªä¼šåœ¨propså¼•èµ·çš„ç»„ä»¶æ›´æ–°æ—¶å€™è°ƒç”¨ï¼ˆ**å·²åºŸé™¤**ï¼‰ğŸš®
> - shouldComponentUpdate()ï¼šé€šè¿‡è¿”å›trueè·Ÿfalseæ¥å†³å®šç»„ä»¶æ˜¯å¦æ›´æ–°ï¼Œåœ¨è¿™é‡Œä¸èƒ½è°ƒç”¨setStateï¼Œä¼šå¼•èµ·å¾ªç¯è°ƒç”¨
> - componentWillUpdate()ï¼šç»„ä»¶æ›´æ–°å‰ï¼Œåœ¨è¿™é‡Œä¸èƒ½è°ƒç”¨setStateï¼Œä¼šå¼•èµ·å¾ªç¯è°ƒç”¨ï¼ˆ**å·²åºŸé™¤**ï¼‰ğŸš®
> - render()
> - getSnapshotBeforeUpdate()
> - componentDidMount()
> - componentDidUpdate()
> - componentWillUnmount() :
> - componentDidCatch()

- è¢«åºŸå¼ƒçš„ä¸‰ä¸ªå‡½æ•°éƒ½æ˜¯åœ¨renderä¹‹å‰ï¼Œå› ä¸ºfiberçš„å‡ºç°ï¼Œå¾ˆå¯èƒ½å› ä¸ºé«˜ä¼˜å…ˆçº§ä»»åŠ¡çš„å‡ºç°æ‰“æ–­ç°æœ‰ä»»åŠ¡å¯¼è‡´å®ƒä»¬è¢«æ‰§è¡Œå¤šæ¬¡

#### å®Œæ•´å£°æ˜å‘¨æœŸå‡½æ•°æ¦‚è§ˆ

|          æŒ‚è½½æ—¶            |  å¤‡æ³¨  |              è¯´æ˜               |
| ------------------------- | ------ | ------------------------------- |
| constructor               | â­ï¸ â¤µï¸ | åˆå§‹çŠ¶æ€ã€å®šä¹‰åˆå§‹çŠ¶æ€ç­‰ç­‰ |
| getDerivedStateFromProps  | ğŸ˜‘ â¤µï¸ | åˆå§‹åŒ–å¤–éƒ¨å±æ€§ä»¥åŠåˆå§‹åŒ–çŠ¶æ€ |
| componentWillMount        | â­ï¸ â¤µï¸ | ç»„ä»¶æ¸²æŸ“åˆ°é¡µé¢ä¹‹å‰æ‰§è¡Œ |
| render                    | â­ï¸ â¤µï¸ | æ¸²æŸ“é˜¶æ®µï¼Œåˆå§‹åŒ– Virtual Dom ç”¨æ¥æè¿° UI |
| React æ›´æ–° DOM å’Œ refs    | ğŸ’¥     | Virtual Dom å®Œæˆï¼Œäº¤ä»˜æµè§ˆå™¨æ‰§è¡Œ UI ç»˜åˆ¶ |
| æµè§ˆå™¨ç»˜åˆ¶ UI             | ğŸ’¥     | ä¸ React æ— å…³ï¼Œæµè§ˆå™¨æ‰§è¡Œ UI ç»˜åˆ¶ |
| componentDidMount         | â­ï¸ â¤µï¸ | ç»„ä»¶æŒ‚è½½åè§¦å‘ï¼Œæ­¤æ—¶é¡µé¢ DOM ç»˜åˆ¶å·²å®Œæˆ |

|          æ›´æ–°æ—¶            |   å¤‡æ³¨  |              è¯´æ˜               |
| ------------------------- | ------- | ------------------------------- |
| componentWillReceiveProps | ğŸ˜‘ ğŸ”‚  | ä¸€èˆ¬æ˜¯ props å‘ç”Ÿæ”¹å˜åè§¦å‘ï¼ˆé¦–æ¬¡ä¸è§¦å‘ï¼‰ |
| getDerivedStateFromProps  | ğŸ˜‘ ğŸ”‚  | v16.4 åå¯ä»¥ä»å¤–éƒ¨å±æ€§æ›´æ–°ä¸€äº›å†…éƒ¨æ–¹æ³• |
| â‘  shouldComponentUpdate   | â­ï¸ ğŸ”‚  | propsã€state æ”¹å˜åè§¦å‘ï¼Œç”¨æ¥ä¼˜åŒ–ç»„ä»¶æ˜¯å¦ render |
| componentWillUpdate       | â­ï¸ ğŸ”‚  | ç»„ä»¶å³å°†è¢«æ›´æ–°æ—¶è§¦å‘ï¼Œæ‰§è¡Œæ›´æ–°é€»è¾‘ |
| â‘¡ render                  | â­ï¸ ğŸ”‚  | ä¸æ‰§è¡Œ â‘  ä¸­è¿”å› false çš„éƒ¨åˆ†ï¼Œè®¡ç®—å…¶ä»–è™šæ‹Ÿ dom çš„éƒ¨åˆ†å¹¶æ‰§è¡Œ render |
| getSnapshotBeforeUpdate   | ğŸ˜‘ğŸ’¥ğŸ”‚ | åœ¨é¡µé¢ UI ç»˜åˆ¶ä¹‹å‰è°ƒç”¨ |
| React æ›´æ–° DOM å’Œ Refs    | ğŸ’¥      | Virtual Dom å®Œæˆï¼Œæ‰§è¡ŒçœŸå® Dom çš„æ›´æ–° |
| æµè§ˆå™¨ç»˜åˆ¶ UI              | ğŸ’¥      | ä¸ React æ— å…³ï¼Œæµè§ˆå™¨æ ¹æ® â‘¡ ç»˜åˆ¶æ–° UI |
| componentDidUpdate        | â­ï¸ ğŸ”‚  | render ä¹‹å & UI æ›´æ–°æ—¶è§¦å‘ï¼Œæ‰§è¡Œæ›´æ–°åé€»è¾‘ |

|          é”€æ¯æ—¶            |   å¤‡æ³¨  |              è¯´æ˜               |
| ------------------------- | ------- | ------------------------------- |
| componentWillUnmount      | â­ï¸ ğŸ”š  | ç»„ä»¶é”€æ¯è§¦å‘ï¼Œæ‰§è¡Œä¸€äº›å¤„ç†ï¼Œé‡Šæ”¾å†…å­˜ |

|          é”™è¯¯å¤„ç†            |   å¤‡æ³¨  |              è¯´æ˜               |
| --------------------------- | ------- | ------------------------------- |
| componentDidCatch(err,info) | ğŸ˜‘ğŸ’¥   | æ•æ‰åˆ°å®ƒçš„å­å…ƒç´ ï¼ˆåŒ…æ‹¬åµŒå¥—å­å…ƒç´ ï¼‰æŠ›å‡ºçš„å¼‚å¸¸ |

#### constructor()

1. ç”¨äºåˆå§‹åŒ–å†…éƒ¨çŠ¶æ€ï¼Œå¾ˆå°‘ä½¿ç”¨ï¼Œåªåœ¨åˆå§‹åŒ–æŒ‚è½½æ—¶æ‰§è¡Œï¼›
2. å”¯ä¸€å¯ä»¥ç›´æ¥ä¿®æ”¹ `state` çš„åœ°æ–¹ï¼ˆå”¯ä¸€ä¸è°ƒç”¨ `this.setState()` å°±å¯ä»¥ä¿®æ”¹ `state` çš„æ–¹å¼ï¼‰ï¼›
3. ç”¨äºè®¾ç½®ç»„ä»¶çš„åˆå§‹çŠ¶æ€ã€‚

ä»æŠ€æœ¯ä¸Šè®²ï¼Œæ„é€ å‡½æ•°å¹¶ä¸æ˜¯ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸçš„æ–¹æ³•ã€‚è¿™é‡Œå°†å®ƒåŒ…å«è¿›æ¥æ˜¯å› ä¸ºå®ƒè¢«ç”¨äºç»„ä»¶åˆå§‹åŒ–ï¼ˆè¿™ä¹Ÿæ˜¯ State è¢«åˆå§‹åŒ–çš„åœ°æ–¹ï¼‰ã€‚å½“ç„¶ï¼Œå½“æŒ‚è½½æŸä¸ªç»„ä»¶æ—¶ï¼Œæ„é€ å‡½æ•°æ°¸è¿œéƒ½æ˜¯ç¬¬ä¸€ä¸ªè¢«è§¦å‘çš„ã€‚ â€”â€” ã€ŠReact å­¦ä¹ æ‰‹å†Œã€‹ï¼ˆåæ–‡å¤§éƒ¨åˆ†å†…å®¹æ‘˜æŠ„äºæœ¬ä¹¦ï¼‰

#### getDerivedStateFromProps()

1. v16.3 å¼•å…¥é€‚ç”¨äº React ä»å¤–éƒ¨å±æ€§åˆå§‹åŒ–ä¸€äº›å†…éƒ¨çŠ¶æ€çš„æ–¹æ³•ï¼›
2. å½“ state éœ€è¦ä» props åˆå§‹åŒ–æ—¶ä½¿ç”¨ï¼›
3. react å†…éƒ¨æ‰§è¡Œï¼›
4. **å°½é‡ä¸è¦ä½¿ç”¨**ï¼Œç»´æŠ¤æ­¤çŠ¶æ€ä¼šå¢åŠ å¤æ‚åº¦ï¼›
5. v16.4 ä»¥åæ¯æ¬¡ render éƒ½ä¼šè°ƒç”¨ï¼›
6. ä½¿ç”¨åœºæ™¯ï¼šè¡¨å•æ§ä»¶è·å–é»˜è®¤å€¼

#### componentWillMount()

ï¼ˆ**å·²åºŸå¼ƒ**ï¼‰

1. å¯ç”¨ constructor + componentDidMount ä»£æ›¿

- è¯·æ±‚ sessionStorage
- å®šä¹‰åˆå§‹åŒ–çš„æ•°æ®ï¼ˆä¾‹å¦‚è¡¨å¤´ã€ä¸€äº›ä¸é€‚åˆæ”¾åœ¨ constructor å†…çš„å¤§é‡çš„é»˜è®¤æ•°æ®ï¼‰
- ä¹Ÿæœ‰ç”¨ä½œæ¥å£è¯·æ±‚ï¼Œç”¨äºåˆå§‹åŒ–çš„æ•°æ®

ä¸€æ—¦å±æ€§è¢«è·å–å¹¶ä¸”åˆå§‹åŒ–äº† Stateï¼Œ`componentWillMount` æ–¹æ³•å°†ä¼šè¢«è§¦å‘ã€‚è¯¥æ–¹æ³•æ˜¯åœ¨ DOM è¢«æ¸²æŸ“ä¹‹å‰è§¦å‘çš„ï¼Œå¹¶ä¸”å¯ä»¥ç”¨æ¥åˆå§‹åŒ–ç¬¬ä¸‰æ–¹è„šæœ¬åº“ã€å¯åŠ¨åŠ¨ç”»ã€è¯·æ±‚æ•°æ®ï¼Œä»¥åŠå…¶ä»–å¯èƒ½éœ€è¦åœ¨ç»„ä»¶è¢«æ¸²æŸ“ä¹‹å‰æ‰§è¡Œçš„é¢å¤–æ­¥éª¤ã€‚è¿˜å¯ä»¥åœ¨è¯¥æ–¹æ³•ä¸­è§¦å‘ `setState` æ–¹æ³•ï¼Œåœ¨ç»„ä»¶åˆæ¬¡è¢«æ¸²æŸ“ä¹‹å‰ä¿®æ”¹ç»„ä»¶çš„ Stateã€‚

ä¸€èˆ¬å¯ä»¥ç”¨æ¥è¯·æ±‚æ¥å£ï¼Œè¿”å›å€¼ä½œä¸ºæ•°æ®æºæ¥åˆ¤æ–­è¡¨æ ¼çš„ loading çŠ¶æ€ç­‰ã€‚

- **åœ¨ç»„ä»¶è¢«æ¸²æŸ“å®Œæ¯•ä¹‹å‰è°ƒç”¨ `setState` æ–¹æ³•å°†ä¸ä¼šå¯åŠ¨æ›´æ–°ç”Ÿå‘½å‘¨æœŸã€‚**
- åœ¨ç»„ä»¶æ¸²æŸ“æˆ‘å®Œæ¯•ä¹‹åå°±è°ƒç”¨ `setState` æ–¹æ³•å°±ä¼šå¯åŠ¨æ›´æ–°ç”Ÿå‘½å‘¨æœŸã€‚å¦‚æœç”¨æˆ·åœ¨ `componentWillMount` æ–¹æ³•ä¸­å®šä¹‰çš„å›è°ƒå‡½æ•°å†…è°ƒç”¨äº† `setState` æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒå°†ä¼šåœ¨ç»„ä»¶è¢«å®Œå…¨æ¸²æŸ“ä¹‹åè§¦å‘ï¼Œå¹¶ä¸”ä¼šå¯åŠ¨æ›´æ–°ç”Ÿå‘½å‘¨æœŸã€‚

#### componentWillReceiveProps(prevProps)

ï¼ˆ**å·²åºŸé™¤**ï¼‰

1. ä¼šç ´åstateæ•°æ®çš„å•ä¸€æ•°æ®æºï¼Œå¯¼è‡´ç»„ä»¶çŠ¶æ€ä¸å¥½é¢„æµ‹ï¼Œè¿˜ä¼šå¢åŠ é‡ç»˜æ¬¡æ•°ï¼Œç”¨ getDerivedStateFromProps æ›¿ä»£

- çˆ¶ç»„ä»¶ä¸­çš„ props å‘ç”Ÿæ”¹å˜æ—¶å€™ï¼Œä¸€èˆ¬ç”¨äºçˆ¶ç»„ä»¶çŠ¶æ€æ›´æ–°æ—¶å­ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚
- ä»…å½“æ–°çš„å±æ€§è¢«ä¼ é€’ç»™ç»„ä»¶åæ‰ä¼šè°ƒç”¨ã€‚è¿™å¯ä»¥è°ƒç”¨ setState æ–¹æ³•ã€‚

#### shouldComponentUpdate(nextprops, nextstates)

1. å†³å®š Virtual Dom æ˜¯å¦éœ€è¦é‡ç»˜ï¼›
2. è‹¥çŠ¶æ€æ”¹å˜è¯¥å‡½æ•°è¿”å› falseï¼Œåˆ™ä¸ä¼šè°ƒç”¨ renderï¼Œå¦åˆ™çŠ¶æ€æ”¹å˜ä¼šæ‰§è¡Œ renderï¼›
3. åº”ç”¨åœºæ™¯ï¼šæ€§èƒ½ä¼˜åŒ–ï¼Œ**è¿”å› false æ¥é˜»æ­¢ä¸å¿…è¦çš„ UI æ›´æ–°**ï¼›

- é¡¹ç›®ä¸­ä¸€èˆ¬ç”¨æ¥ç»„ç»‡è°ƒç”¨ renderï¼Œä»¥åŠå¤„ç†ä¸€äº›æ›´æ–°çš„äº‹ä»¶ã€‚
- æ›´æ–°ç”Ÿå‘½å‘¨æœŸçš„é—¨å«ï¼Œä¸€ä¸ªå¯ä»¥å–æ¶ˆæ›´æ–°æ“ä½œçš„è°“è¯ã€‚è¯¥æ–¹æ³•å¯ä»¥é€šè¿‡å€¼å…è®¸æ‰§è¡Œå¿…é¡»çš„æ›´æ–°æ¥æ”¹è¿›æ€§èƒ½ã€‚

`shouldComponentUpdate` æ–¹æ³•å¯ä»¥æ¯”è¾ƒæ–°æ—§å±æ€§ä¹‹é—´çš„å·®å¼‚ã€‚æ–°å±æ€§ä¼šä½œä¸ºå‚æ•°ä¼ ç»™è¯¥æ–¹æ³•ï¼Œæ—§å±æ€§ä»ç„¶åœ¨å½“å‰ props ä¸­ï¼Œå¹¶ä¸”è¯¥ç»„ä»¶è¿˜æœªè¢«æ›´æ–°ã€‚
å¦‚æœ `shouldComponentUpdate` è¿”å›çš„æ˜¯ trueï¼Œå…¶ä½™æ›´æ–°çš„ç”Ÿå‘½å‘¨æœŸå°†ä¼šçŸ¥é“è¿™ä¸€ç‚¹ã€‚å…¶ä½™çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¹Ÿä¼šé€šè¿‡å‚æ•°æ¥æ”¶åˆ°æ–°çš„ props å’Œæ–°çš„ Stateã€‚ï¼ˆ`componentDidUpdate` æ–¹æ³•ä¼šæ¥æ”¶åˆ°ä¸Šä¸€ä¸ª props å’Œä¸Šä¸€ä¸ª Stateï¼Œå› ä¸ºä¸€æ—¦è¯¥æ–¹æ³•è¢«è§¦å‘äº†ï¼Œæ›´æ–°æ“ä½œå°±å·²ç»æ‰§è¡Œäº†ï¼Œprops ä¹Ÿä¼šå‘ç”Ÿäº†å˜åŒ–ï¼‰ã€‚

#### componentWillUpdate(nextProps, nextState)

ï¼ˆ**å·²åºŸé™¤**ï¼‰

1. ç”¨ getSnapshotBeforeUpdate(prevProps, prevState) è¿”å›çš„å€¼ä½œä¸º componentDidUpdate ç¬¬ä¸‰ä¸ªå‚æ•°;
2. componentDidUpdate(prevProps, prevState, snapshot)

- å·²åºŸé™¤çš„ç”Ÿå‘½å‘¨æœŸæ¨èä½¿ç”¨ï¼Œä½†ä»ç„¶å¯ä»¥ä½œä¸ºç»„ä»¶æ•°æ®æ›´æ–°åï¼Œrender å‰æ‰§è¡Œçš„æ“ä½œï¼›
- åœ¨ç»„ä»¶æ›´æ–°ä¹‹å‰æ‰§è¡Œè§¦å‘ã€‚å’Œ `componentWillMount` ç±»ä¼¼ï¼Œå®ƒåªä¼šåœ¨æ¯æ¬¡æ›´æ–°æ“ä½œä¹‹å‰è§¦å‘ã€‚
- **åœ¨ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œ`componentWillUpdate` ç´§è·Ÿç€ `shouldComponentUpdate` æ–¹æ³•ä¹‹åæ‰§è¡Œã€‚**

#### render()

1. æ¸²æŸ“é˜¶æ®µï¼Œç”¨æ¥æè¿° UIï¼Œå³ç”Ÿæˆ è™šæ‹Ÿ Domï¼›
2. æ›´æ–°æ—¶ä¸ä¼šå»æ‰§è¡Œ `shouldComponentUpdate()` è¿”å› false çš„éƒ¨åˆ†ï¼›
3. è®¡ç®—è™šæ‹Ÿ Dom ä¸­éœ€è¦æ›´æ–°çš„éƒ¨åˆ†å¹¶å» render å®ƒï¼›
4. å®šä¹‰ Domï¼Œå¹¶è¿”å› React Domï¼›

#### getSnapshotBeforeUpdate()

ï¼ˆ**v16.3 æ–°å¢**ï¼‰æ¨èä½¿ç”¨

1. åœ¨é¡µé¢ render ä¹‹å‰è°ƒç”¨ï¼Œstate å·²æ›´æ–°ï¼›
2. åº”ç”¨åœºæ™¯ï¼šè·å– render ä¹‹å‰çš„ DOM çŠ¶æ€ï¼›
3. ä¼šåœ¨æœ€ç»ˆç¡®å®šçš„renderæ‰§è¡Œä¹‹å‰æ‰§è¡Œï¼Œèƒ½ä¿è¯åˆ°è·Ÿ componentDidUpdate çš„å…ƒç´ çŠ¶æ€ç›¸åŒ

#### componentDidMount()

1. UI æ¸²æŸ“å®Œæˆä¹‹åè°ƒç”¨ï¼›
2. åªæ‰§è¡Œä¸€æ¬¡ï¼›
3. å…¸å‹åœºæ™¯ï¼šè·å–å¤–éƒ¨èµ„æº
4. ä¸€èˆ¬åœ¨æŒ‚è½½é˜¶æ®µ å‘èµ· `Ajax`è¯·æ±‚ã€å®šä¹‰èµ„æºã€åšä¸€äº›å¤„ç†å‰¯ä½œç”¨çš„äº‹æƒ…

- `componentDidMount` æ–¹æ³•æ˜¯å¦å¤–ä¸€ä¸ªåˆ›å»º API è¯·æ±‚çš„åœ°æ–¹ï¼Œè¯¥æ–¹æ³•åªä¼šåœ¨ç»„ä»¶æ¸²æŸ“å®Œæ¯•ä¹‹åè§¦å‘ã€‚è¯¥æ–¹æ³•ä¸­ä»»æ„çš„ `setState` æ–¹æ³•è°ƒç”¨éƒ½å°†å¯åŠ¨æ›´æ–°ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶ä¸”é‡æ–°æ¸²æŸ“ç»„ä»¶ã€‚
- ä¹Ÿæ˜¯åˆå§‹åŒ–ä»»ä½•éœ€è¦ç”¨åˆ° DOM çš„ç¬¬ä¸‰æ–¹ JavaScript çš„åœ°æ–¹ï¼Œä¾‹å¦‚ï¼Œä¸€äº›äº¤äº’ç”Ÿæˆçš„ dom å¯ä»¥åœ¨è¿™é‡Œå¤„ç†ã€‚
- è¯¥æ–¹æ³•çš„å¦ä¸€ä¸ªæœ‰ç‚¹äº‹å¯ä»¥ç”¨äºå¯åŠ¨è¯¸å¦‚ `intervals` æˆ–è€… `timers` è¿™æ ·çš„åå°è¿›ç¨‹ã€‚ä»»ä½• `componentDidMount` æˆ–è€… `componentWillMount` æ–¹æ³•ä¸­å¯åŠ¨çš„è¿›ç¨‹éƒ½å¯ä»¥åœ¨ `componentWillUnmount` æ–¹æ³•ä¸­è¢«æ¸…é™¤ã€‚å½“ä¸éœ€è¦è¿™äº›åå°è¿›ç¨‹æ—¶ï¼Œç”¨æˆ·å¯èƒ½ä¹Ÿä¸å¸Œæœ›å®ƒä»¬ç»§ç»­åœ¨åå°æ‰§è¡Œã€‚

#### componentDidUpdate(prevProps, prevState, snapshot)

1. æ¯æ¬¡ UI æ›´æ–°åéƒ½ä¼šè¢«è°ƒç”¨ï¼›
2. åšä¸€äº›æ›´æ–°åçš„æ“ä½œï¼›
3. åº”ç”¨åœºæ™¯ï¼šé¡µé¢éœ€è¦ props å˜åŒ–é‡æ–°è·å–æ•°æ®ï¼›

- åªåœ¨æ›´æ–°æ“ä½œå‘ç”Ÿä¹‹åï¼Œè°ƒç”¨ render æ–¹æ³•ä¹‹åè§¦å‘ã€‚ç±»ä¼¼ `componentDidmount` æ–¹æ³•ï¼Œä¸è¿‡å®ƒåœ¨æ¯æ¬¡æ›´æ–°ä¹‹åè§¦å‘ã€‚

#### componentWillUnmount()

1. ç»„ä»¶å¸è½½åŠé”€æ¯ä¹‹å‰æ‰§è¡Œï¼Œåšä¸€äº›é‡Šæ”¾èµ„æºçš„äº‹æƒ…ï¼›

`componentWillUnmount` æ–¹æ³•åªä¼šåœ¨ç»„ä»¶è¢«å¸è½½ä¹‹å‰è§¦å‘ã€‚

#### componentDidCatch()

1. React 16 æä¾›çš„ä¸€ä¸ªå†…ç½®å‡½æ•° componentDidCatch(err,info)ï¼Œå¦‚æœ render() å‡½æ•°æŠ›å‡ºé”™è¯¯ï¼Œè¯¥å‡½æ•°å¯ä»¥æ•æ‰åˆ°é”™è¯¯ä¿¡æ¯ï¼Œå¹¶ä¸”å¯ä»¥å±•ç¤ºç›¸åº”çš„é”™è¯¯ä¿¡æ¯
2. ç¬¬ä¸€ä¸ªå‚æ•°æŒ‡çš„æ˜¯æŠ›å‡ºçš„å®é™…é”™è¯¯ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯æŒ‡é”™è¯¯ä¿¡æ¯ã€‚

#### ç»ƒä¹  Demo

```javascript
/**
 * react ç±»ç»„ä»¶ç»§æ‰¿äº† react Component è¿™ä¸ªåŸºç±»ï¼Œæ‰èƒ½ä½¿ç”¨ ç”Ÿå‘½å‘¨æœŸçš„æ–¹æ³•
 * å‡½æ•°ç»„ä»¶ä¸èƒ½ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸæ–¹æ³•çš„åŸå› ä¹Ÿæ˜¯å¦‚æ­¤
 */ 
import React, { useState, Component } from "react";

// å­ (ç±»)ç»„ä»¶
class ChoidrenComponent extends Component {
  /**
   * æ„é€ å‡½æ•°
   * @param {object} props ä¸å¯è¢«æ›´æ”¹çš„ç»„ä»¶
   */
  constructor(props) {
    super(props);
    this.state = { count: 0, color: "#FFF000" };
    console.log("æ„é€ å‡½æ•°-æ‰§è¡Œ");
  }

  /**
   * getDerivedStateFormProps é˜¶æ®µï¼š
   * çº¯å‡€ä¸”ä¸åŒ…å«å‰¯ä½œç”¨ã€‚å¯èƒ½ä¼šè¢« React æš‚åœï¼Œä¸­æ­¢æˆ–é‡æ–°å¯åŠ¨
   * 16.3 ä»¥åæ–°åŠ 
   */
  getDerivedStateFormProps() {
    // ä¸æ¨èä½¿ç”¨ï¼Œ React å†…éƒ¨æ‰§è¡Œ
    console.log("getDerivedStateFormProps è¢«æ‰§è¡Œ");
  }

  /**
   * componentWillmounté˜¶æ®µï¼š
   * ç°ç‰ˆæœ¬å·²ç§»é™¤
   */
  componentWillMount() {
    // ä¸æ¨èä½¿ç”¨ï¼Œ React å†…éƒ¨æ‰§è¡Œ
    console.log("componentWillMount æ‰§è¡Œ");
  }

  /**
   * ç»„ä»¶æ›´æ–°é˜¶æ®µ - æ‰‹åŠ¨æ›´æ–° (æ€§èƒ½ä¼˜åŒ–)
   * react ç»„ä»¶çš„çµæ´»æ€§çš„ä½“ç°ï¼šå°†ä¸éœ€è¦å¼•èµ· dom æ›´æ–°çš„å€¼ return falseï¼Œå¯é˜»æ­¢ä¸å¿…è¦çš„æ€§èƒ½æµªè´¹
   * å‡çº§åˆ° hook çš„ç‰ˆæœ¬ => useMemo()
   */
  shouldComponentUpdate(nextProps, nextState) {
    if (nextProps.color !== this.props.color) {
      console.log("æ‰§è¡Œäº† shouldComponentUpdate");
      return true;
    }
  }

  /**
   * ç»„ä»¶æ›´æ–°é˜¶æ®µ - ç›‘å¬
   * props æ•°æ®æ›´æ–°åæ‰ä¼šæ‰§è¡Œæ­¤å‡½æ•°
   * ä¸€èˆ¬å¯ä»¥ç”¨æ¥æ“ä½œä¸€äº›æ›´æ–°æ“ä½œ
   * @param {object} nextProps æ›´æ–°çš„ props ä¼ å…¥çš„ porps æ”¹å˜æ‰§è¡Œ
   */
  componentWillReceiveProps(nextProps) {
    if (nextProps.color !== this.props.color) {
      this.setState({ color: nextProps.color });
      console.log(`count ç”± ${this.state.color} å˜åŒ–åˆ°äº† ${nextProps.color}`);
    }
    console.log("æ‰§è¡Œäº† componentWillReceivePropsï¼Œè¯´æ˜ props çš„å†…å®¹å‘ç”Ÿæ”¹å˜");
  }

  /**
   * åˆšå¼€å§‹æ¸²æŸ“çš„æ—¶å€™--ç”Ÿå‘½å‘¨æœŸå‡½æ•°
   */
  componentDidMount() {
    console.log(
      `componentDidMount => You Clicked ${this.state.count}ï¼Œæ‰§è¡Œäº†--æ¸²æŸ“--`
    );
  }

  /**
   * ç»„ä»¶æ›´æ–°çš„æ—¶å€™è°ƒç”¨--ç”Ÿå‘½å‘¨æœŸå‡½æ•°
   */
  componentDidUpdate() {
    console.log(
      `componentDidUpdate=> You Clicked ${this.state.count}ï¼Œæ‰§è¡Œäº†--æ›´æ–°--`
    );
  }

  /**
   * ç»„ä»¶å¸è½½é˜¶æ®µæ‰§è¡Œ
   * é€šå¸¸æ˜¯ react ç»„ä»¶ä»¥åŠä» DOM ä¸­ç§»é™¤ï¼ˆå³ UI å¸è½½ä¹‹åæ‰§è¡Œï¼‰ï¼Œä½†æ˜¯ç»„ä»¶ä¸­è¿˜æœ‰ä¸€äº›æ“ä½œæœªç»“æŸï¼š
   * 1. æ¸…é™¤å®šæ—¶å™¨
   * 2. è§£ç»‘ dom äº‹ä»¶
   * 3. æ¸…é™¤ç½‘ç»œçŠ¶æ€
   *
   * **å°†çŠ¶æ€æˆ–è€…å˜é‡è®¾ç½® null åï¼Œæµè§ˆå™¨ä¼šåœ¨ä¸‹æ¬¡åƒåœ¾å›æ”¶ä¸­æ¸…é™¤æ²¡ç”¨çš„å˜é‡**
   */
  componentWillUnmount() {
    console.log("ç»„ä»¶å¸è½½ï¼Œæ‰§è¡Œ => componentWillUnmount");
  }

  /**
   * æ­¤åéƒ½ä¸ºè‡ªå®šä¹‰å‡½æ•°
   */
  addCount() {
    this.setState({
      count: this.state.count + 4,
    });
  }

  /**
   * æ¸²æŸ“é˜¶æ®µ -- ä¸€èˆ¬ render å†™åœ¨æœ€å
   * @returns react dom
   */
  render() {
    console.log("æ‰§è¡Œäº† render");
    return (
      <div style={{ fontSize: "18px" }}>
        <h1
          style={{ backgroundColor: this.state.color }}
        >{`propsæ”¹å˜color ${this.state.color}`}</h1>
        <br />
        {this.state.count} times<br></br>
        <button onClick={this.addCount.bind(this)}>Click</button>
      </div>
    );
  }
}

// çˆ¶ç»„ä»¶
const ClassComponent = () => {
  const [color, setVal] = useState(null);
  const [isShow, setIsShow] = useState(true);
  return (
    <div
      style={{ border: "2px solid #1995d3" }}
      onClick={() => setVal((v) => `#${Math.random().toString(16).substr(-6)}`)}
    >
      <button onClick={() => setIsShow(!isShow)}>å¸è½½å­ç»„ä»¶</button>
      {isShow && <ChoidrenComponent color={color} />}
    </div>
  );
};

export default ClassComponent;

```

#### æ›´æ–°ç”Ÿå‘½å‘¨æœŸ

æ›´æ–°ç”Ÿå‘½å‘¨æœŸæ˜¯å½“ç»„ä»¶ State å‘ç”Ÿå˜åŒ–æˆ–è€…ä»çˆ¶ç»„ä»¶æ¥æ”¶åˆ°æ–°çš„å±æ€§æ—¶è§¦å‘çš„ä¸€ç³»åˆ—æ–¹æ³•ã€‚è¯¥ç³»åˆ—ç”Ÿå‘½å‘¨æœŸå¯ä»¥ç”¨æ¥åœ¨æ›´æ–°ç»„ä»¶ä¹‹å‰æˆ–è€…ä¹‹åä¸ DOM äº¤äº’æ—¶é›†æˆ JavaScriptã€‚æ­¤å¤–å®ƒè¿˜å¯ä»¥ç”¨æ¥æ”¹è¿›åº”ç”¨ç¨‹åºçš„æ€§èƒ½ï¼Œå› ä¸ºå®ƒä¸ºç”¨æˆ·æä¾›äº†å–æ¶ˆä¸å¿…è¦æ›´æ–°æ“ä½œçš„èƒ½åŠ›ã€‚

æ›´æ–°ç”Ÿå‘½å‘¨æœŸä¼šåœ¨æ¯æ¬¡è°ƒç”¨ setState æ–¹æ³•åå¯åŠ¨ã€‚**è°ƒç”¨ setState æ–¹æ³•è¿‡ç¨‹å†…éƒ¨çš„æ›´æ–°ç”Ÿå‘½å‘¨æœŸå°†ä¼šå¼•å‘æ— é™é€’å½’å¾ªç¯**ï¼Œä»è€Œå¯¼è‡´å †æ ˆæº¢å‡ºçš„é”™è¯¯ã€‚å› æ­¤ï¼Œåªèƒ½åœ¨ `componentWillReceiveProps` æ–¹æ³•å†…éƒ¨è°ƒç”¨ setState æ–¹æ³•ï¼Œå®ƒå…è®¸ç»„ä»¶å±æ€§è¢«æ›´æ–°åæ›´æ–° Stateã€‚

ğŸ˜„ğŸ˜†ğŸ˜ŠğŸ˜ƒğŸ˜ğŸ˜ğŸ˜˜ğŸ˜šğŸ˜³ğŸ˜ŒğŸ˜†ğŸ˜ğŸ˜‰ğŸ˜œğŸ˜ğŸ˜€ğŸ˜—ğŸ˜™ğŸ˜›ğŸ˜´ğŸ˜ŸğŸ˜¦ğŸ˜§ğŸ˜®ğŸ˜¬ğŸ˜•ğŸ˜¯ğŸ˜‡
    *æ–‡æ¡£ä¸åˆç†çš„åœ°æ–¹æ•¬è¯·åŠæ—¶æ›´æ­£ï¼Œè°¢è°¢*
ğŸ˜‘ğŸ˜’ğŸ˜…ğŸ˜“ğŸ˜¥ğŸ˜©ğŸ˜”ğŸ˜ğŸ˜–ğŸ˜¨ğŸ˜°ğŸ˜£ğŸ˜¢ğŸ˜­ğŸ˜‚ğŸ˜²ğŸ˜±ğŸ˜«ğŸ˜ ğŸ˜¡ğŸ˜¤ğŸ˜ªğŸ˜‹ğŸ˜·ğŸ˜ğŸ˜µğŸ˜ğŸ˜¶
